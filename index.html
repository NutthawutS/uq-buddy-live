<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UQ Buddy Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f0f1a;
      --bg-secondary: #1a1a2e;
      --bg-card: #16213e;
      --accent-gold: #f6c90e;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --accent-purple: #8b5cf6;
      --accent-pink: #ec4899;
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --border-color: #2d3748;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Prompt', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
    .bg-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse at 20% 20%, rgba(59,130,246,0.15) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, rgba(139,92,246,0.1) 0%, transparent 50%); }
    
    /* Header */
    .header { background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card)); padding: 1rem 2rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    .logo { display: flex; align-items: center; gap: 0.75rem; }
    .logo-icon { width: 45px; height: 45px; background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
    .logo-text h1 { font-family: 'Kanit', sans-serif; font-size: 1.2rem; background: linear-gradient(135deg, var(--accent-gold), var(--text-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .logo-text p { font-size: 0.75rem; color: var(--text-secondary); }
    .header-right { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
    .week-badge { background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue)); padding: 0.35rem 0.75rem; border-radius: 14px; font-size: 0.8rem; font-weight: 600; }
    .btn { border: none; padding: 0.4rem 0.8rem; border-radius: 6px; cursor: pointer; font-family: inherit; font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem; transition: all 0.2s; }
    .btn-refresh { background: linear-gradient(135deg, var(--accent-green), var(--accent-blue)); color: white; }
    .btn-settings { background: rgba(255,255,255,0.1); border: 1px solid var(--border-color); color: white; }
    .btn:hover { opacity: 0.9; transform: scale(1.02); }
    .data-source { font-size: 0.65rem; padding: 0.15rem 0.4rem; border-radius: 4px; }
    .data-source.live { background: rgba(16,185,129,0.2); color: var(--accent-green); }
    .data-source.demo { background: rgba(245,158,11,0.2); color: var(--accent-orange); }
    
    /* Tabs */
    .nav-tabs { display: flex; gap: 0.4rem; padding: 0.75rem 2rem; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); overflow-x: auto; }
    .nav-tab { background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); padding: 0.5rem 1rem; border-radius: 8px; color: var(--text-secondary); font-size: 0.85rem; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
    .nav-tab:hover { border-color: var(--accent-purple); color: var(--accent-purple); }
    .nav-tab.active { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; border-color: transparent; }
    
    /* Main */
    .main-content { padding: 1.5rem 2rem; max-width: 1400px; margin: 0 auto; }
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    /* Challenge Banner */
    .challenge-banner { background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(245,158,11,0.2)); border-radius: 12px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    .challenge-banner.next { background: linear-gradient(135deg, rgba(139,92,246,0.15), rgba(59,130,246,0.15)); }
    .challenge-left h2 { font-size: 1.1rem; margin-bottom: 0.3rem; }
    .challenge-left p { font-size: 0.85rem; color: var(--text-secondary); }
    .challenge-right { text-align: center; }
    .time-display { font-size: 1.8rem; font-weight: 700; color: var(--accent-gold); }
    .time-label { font-size: 0.75rem; color: var(--text-secondary); }
    
    /* Stats Row */
    .stats-row { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap; justify-content: center; }
    .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 0.6rem 1rem; text-align: center; min-width: 90px; }
    .stat-card .value { font-size: 1.3rem; font-weight: 700; color: var(--accent-gold); }
    .stat-card .label { font-size: 0.7rem; color: var(--text-secondary); }
    
    /* Grid */
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.25rem; }
    .card { background: linear-gradient(145deg, var(--bg-card), var(--bg-secondary)); border-radius: 12px; border: 1px solid var(--border-color); overflow: hidden; }
    .card.full-width { grid-column: 1 / -1; }
    .card-header { padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 0.4rem; }
    .card-body { padding: 1rem; }
    
    /* Progress */
    .progress-section { margin-bottom: 1rem; }
    .progress-header { display: flex; justify-content: space-between; margin-bottom: 0.4rem; font-size: 0.85rem; }
    .progress-count { font-weight: 700; color: var(--accent-gold); }
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 3px; transition: width 0.5s; }
    .progress-fill.mtk { background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); }
    .progress-fill.arp { background: linear-gradient(90deg, var(--accent-green), var(--accent-blue)); }
    
    /* Campaign List */
    .campaign-list { display: grid; gap: 0.35rem; }
    .campaign-item { display: flex; justify-content: space-between; align-items: center; padding: 0.4rem 0.6rem; background: rgba(255,255,255,0.03); border-radius: 5px; border-left: 3px solid transparent; font-size: 0.85rem; }
    .campaign-item.done { border-left-color: var(--accent-green); }
    .campaign-item.pending { border-left-color: var(--accent-orange); }
    .campaign-status { font-size: 0.7rem; padding: 0.1rem 0.4rem; border-radius: 8px; }
    .campaign-status.done { background: rgba(16,185,129,0.2); color: var(--accent-green); }
    .campaign-status.pending { background: rgba(245,158,11,0.2); color: var(--accent-orange); }
    
    /* UQ Friends Section */
    .friends-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed var(--border-color); }
    .friends-title { font-size: 0.75rem; color: var(--accent-pink); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.3rem; }
    .friends-note { font-size: 0.65rem; color: var(--text-secondary); font-style: italic; }
    .friend-item { display: flex; justify-content: space-between; align-items: center; padding: 0.35rem 0.5rem; background: rgba(236,72,153,0.05); border-radius: 5px; margin-bottom: 0.3rem; font-size: 0.8rem; border-left: 3px solid var(--accent-pink); }
    .friend-item.done { border-left-color: var(--accent-green); background: rgba(16,185,129,0.05); }
    .friend-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-green); }
    
    /* Leaderboard */
    .leaderboard-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.03); border-radius: 6px; margin-bottom: 0.35rem; }
    .leaderboard-item.gold { background: linear-gradient(135deg, rgba(246,201,14,0.15), rgba(255,255,255,0.03)); border: 1px solid rgba(246,201,14,0.3); }
    .rank-badge { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
    .rank-badge.r1 { background: linear-gradient(135deg, #ffd700, #ffb700); }
    .rank-badge.r2 { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); }
    .rank-badge.r3 { background: linear-gradient(135deg, #cd7f32, #a0522d); color: #fff; }
    .user-info { flex: 1; }
    .user-name { font-weight: 600; font-size: 0.85rem; }
    .user-title { font-size: 0.65rem; padding: 0.1rem 0.3rem; border-radius: 3px; background: rgba(246,201,14,0.2); color: var(--accent-gold); margin-left: 0.25rem; }
    .user-time { font-size: 0.7rem; color: var(--text-secondary); }
    .badge-count { font-size: 0.65rem; padding: 0.1rem 0.3rem; border-radius: 3px; background: rgba(255,255,255,0.1); margin-left: 0.2rem; }
    
    /* Badges Grid */
    .badges-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
    .badge-item { padding: 0.6rem; background: rgba(255,255,255,0.03); border-radius: 6px; text-align: center; }
    .badge-item .icon { font-size: 1.3rem; }
    .badge-item .label { font-size: 0.65rem; color: var(--text-secondary); margin: 0.2rem 0; }
    .badge-item .count { font-size: 1.1rem; font-weight: 700; color: var(--accent-gold); }
    
    /* Summary Tabs */
    .summary-tabs { display: flex; gap: 0.4rem; margin-bottom: 1rem; }
    .summary-tab { flex: 1; padding: 0.5rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; text-align: center; font-size: 0.8rem; transition: all 0.2s; }
    .summary-tab:hover { background: rgba(255,255,255,0.1); }
    .summary-tab.active { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-color: transparent; }
    .summary-content { display: none; }
    .summary-content.active { display: block; }
    .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 600px) { .summary-grid { grid-template-columns: 1fr; } }
    .summary-section { background: rgba(255,255,255,0.03); padding: 0.75rem; border-radius: 6px; }
    .summary-section h4 { font-size: 0.8rem; margin-bottom: 0.5rem; }
    .summary-section h4.best { color: var(--accent-green); }
    .summary-section h4.worst { color: var(--accent-red); }
    .below-note { font-size: 0.65rem; color: var(--text-secondary); margin-bottom: 0.5rem; padding: 0.3rem 0.5rem; background: rgba(255,255,255,0.03); border-radius: 4px; }
    .summary-item { padding: 0.5rem; background: rgba(255,255,255,0.03); border-radius: 5px; margin-bottom: 0.4rem; border-left: 3px solid transparent; }
    .summary-item.best-item { border-left-color: var(--accent-green); }
    .summary-item.worst-item { border-left-color: var(--accent-red); }
    .summary-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.3rem; }
    .summary-item .rank { font-weight: 700; font-size: 0.85rem; }
    .summary-item .rank.r1 { color: #ffd700; }
    .summary-item .rank.r2 { color: #c0c0c0; }
    .summary-item .rank.r3 { color: #cd7f32; }
    .summary-item .result { font-weight: 600; color: var(--accent-gold); background: rgba(246,201,14,0.15); padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.75rem; }
    .summary-item .campaign-full { font-size: 0.7rem; color: var(--text-secondary); line-height: 1.3; word-break: break-word; margin-bottom: 0.3rem; }
    .copy-btn { background: rgba(59,130,246,0.2); border: 1px solid var(--accent-blue); color: var(--accent-blue); padding: 0.2rem 0.4rem; border-radius: 3px; cursor: pointer; font-size: 0.65rem; transition: all 0.2s; }
    .copy-btn:hover { background: var(--accent-blue); color: white; }
    .copy-btn.copied { background: var(--accent-green); border-color: var(--accent-green); color: white; }
    
    /* Simulator */
    .simulator-container { display: grid; grid-template-columns: 300px 1fr; gap: 1.5rem; }
    @media (max-width: 800px) { .simulator-container { grid-template-columns: 1fr; } }
    .phone { width: 300px; height: 550px; background: linear-gradient(145deg, #1a1a1a, #2d2d2d); border-radius: 30px; padding: 8px; margin: 0 auto; }
    .phone-screen { background: #7bb4e3; height: 100%; border-radius: 24px; overflow: hidden; display: flex; flex-direction: column; }
    .phone-header { background: #06c755; color: white; padding: 12px; display: flex; align-items: center; gap: 8px; }
    .phone-header .avatar { width: 35px; height: 35px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .phone-header .group-name { font-weight: 600; font-size: 0.9rem; }
    .phone-header .group-members { font-size: 0.7rem; opacity: 0.8; }
    .chat-area { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
    .message { max-width: 85%; padding: 8px 12px; border-radius: 14px; font-size: 0.85rem; line-height: 1.3; }
    .message.user { background: #06c755; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .message.bot { background: white; color: #333; align-self: flex-start; border-bottom-left-radius: 4px; white-space: pre-line; }
    .message.bot .bot-name { font-size: 0.65rem; color: #06c755; font-weight: 600; margin-bottom: 3px; }
    .message.bot .mention-tag { color: #0091ea; font-weight: 600; }
    .chat-input { background: white; padding: 8px; display: flex; gap: 6px; }
    .chat-input input { flex: 1; border: 1px solid #ddd; border-radius: 16px; padding: 8px 12px; font-size: 0.85rem; outline: none; }
    .chat-input button { background: #06c755; color: white; border: none; border-radius: 50%; width: 36px; height: 36px; cursor: pointer; font-size: 1rem; }
    .typing-indicator { display: flex; gap: 3px; padding: 8px 12px; background: white; border-radius: 14px; width: fit-content; }
    .typing-indicator span { width: 6px; height: 6px; background: #999; border-radius: 50%; animation: typing 1.4s infinite; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-4px); } }
    
    .sim-controls { display: flex; flex-direction: column; gap: 1rem; }
    .control-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 1rem; }
    .control-card h3 { font-size: 0.9rem; margin-bottom: 0.75rem; }
    .scenario-btn { width: 100%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; border: none; padding: 0.75rem; border-radius: 8px; font-size: 0.85rem; cursor: pointer; text-align: left; margin-bottom: 0.5rem; transition: all 0.2s; }
    .scenario-btn:hover { transform: translateX(5px); }
    .scenario-btn .title { font-weight: 600; }
    .scenario-btn .desc { font-size: 0.75rem; opacity: 0.85; }
    .quick-commands { display: flex; flex-wrap: wrap; gap: 0.4rem; }
    .quick-cmd { background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); padding: 0.4rem 0.6rem; border-radius: 6px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; }
    .quick-cmd:hover { border-color: var(--accent-purple); color: var(--accent-purple); }
    .quick-cmd.update { border-color: var(--accent-green); color: var(--accent-green); }
    .quick-cmd.danger { border-color: var(--accent-red); color: var(--accent-red); }
    .sim-status { background: rgba(255,255,255,0.03); border-radius: 6px; padding: 0.75rem; margin-top: 0.5rem; }
    .sim-status-title { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
    .sim-status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.3rem; font-size: 0.75rem; }
    .sim-status-item { display: flex; justify-content: space-between; }
    .sim-status-item .value.done { color: var(--accent-green); }
    .sim-status-item .value.pending { color: var(--accent-orange); }
    .clear-btn { width: 100%; background: linear-gradient(135deg, var(--accent-pink), var(--accent-red)); color: white; border: none; padding: 0.6rem; border-radius: 6px; margin-top: 0.75rem; cursor: pointer; font-size: 0.8rem; }
    
    /* Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal-overlay.show { display: flex; }
    .modal { background: var(--bg-card); border-radius: 12px; padding: 1.25rem; width: 90%; max-width: 400px; border: 1px solid var(--border-color); }
    .modal h2 { font-size: 1rem; margin-bottom: 0.75rem; }
    .status-indicator { display: flex; align-items: center; gap: 0.4rem; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 5px; margin-bottom: 0.75rem; font-size: 0.75rem; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-red); }
    .status-dot.connected { background: var(--accent-green); }
    .form-group { margin-bottom: 0.75rem; }
    .form-group label { display: block; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem; }
    .input-wrapper { display: flex; gap: 0.3rem; }
    .form-group input { flex: 1; padding: 0.5rem 0.75rem; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 5px; color: white; font-size: 0.8rem; }
    .toggle-btn { background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 0.5rem; border-radius: 5px; cursor: pointer; }
    .save-btn { width: 100%; padding: 0.6rem; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border: none; border-radius: 5px; color: white; font-size: 0.85rem; font-weight: 600; cursor: pointer; }
    .help-box { margin-top: 0.75rem; padding: 0.6rem; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 0.7rem; color: var(--text-secondary); }
    .close-btn { width: 100%; margin-top: 0.5rem; padding: 0.4rem; background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
    
    /* Toast */
    .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent-green); color: white; padding: 0.6rem 1.25rem; border-radius: 6px; font-size: 0.85rem; font-weight: 500; z-index: 9999; opacity: 0; transition: all 0.3s ease; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    
    /* Star Request Section */
    .star-request-section { margin-top: 1.5rem; padding: 1rem; background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05)); border: 1px solid rgba(255,215,0,0.3); border-radius: 10px; }
    .star-request-section h3 { margin: 0 0 0.5rem 0; font-size: 1rem; color: #ffd700; }
    .star-desc { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 1rem; }
    .selected-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; }
    .selected-box { padding: 0.75rem; border-radius: 8px; background: rgba(0,0,0,0.2); }
    .selected-box.best { border-left: 3px solid var(--accent-green); }
    .selected-box.worst { border-left: 3px solid var(--accent-red); }
    .selected-box h4 { font-size: 0.8rem; margin: 0 0 0.5rem 0; }
    .selected-box div { font-size: 0.7rem; color: var(--text-secondary); }
    .selected-box .selected-item { color: white; padding: 0.2rem 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .selected-box .selected-item:last-child { border-bottom: none; }
    .submit-star-btn { width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #ffd700, #ffaa00); border: none; border-radius: 8px; color: #000; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .submit-star-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(255,215,0,0.3); }
    .submit-star-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* Campaign checkbox */
    .campaign-checkbox { display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.6rem; background: rgba(255,255,255,0.05); border-radius: 6px; margin-bottom: 0.4rem; cursor: pointer; transition: all 0.2s; }
    .campaign-checkbox:hover { background: rgba(255,255,255,0.1); }
    .campaign-checkbox input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; }
    .campaign-checkbox.checked { background: rgba(255,215,0,0.15); border: 1px solid rgba(255,215,0,0.3); }
    .campaign-checkbox .camp-name { flex: 1; font-size: 0.7rem; word-break: break-all; }
    .campaign-checkbox .camp-result { font-size: 0.7rem; color: var(--accent-blue); }
    
    .footer { text-align: center; padding: 1rem; color: var(--text-secondary); font-size: 0.7rem; }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  
  <header class="header">
    <div class="logo">
      <div class="logo-icon">ü§ñ</div>
      <div class="logo-text">
        <h1>UQ Buddy Dashboard</h1>
        <p>Report Champion League</p>
      </div>
    </div>
    <div class="header-right">
      <div class="week-badge" id="weekBadge">üìÖ Week: -</div>
      <span class="data-source demo" id="dataSource">Demo</span>
      <button class="btn btn-refresh" onclick="loadData()">üîÑ</button>
      <button class="btn btn-settings" onclick="openSettings()">‚öôÔ∏è</button>
    </div>
  </header>

  <nav class="nav-tabs">
    <button class="nav-tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
    <button class="nav-tab" onclick="switchTab('ranking')">üèÜ Ranking</button>
    <button class="nav-tab" onclick="switchTab('simulator')">üì± Simulator</button>
  </nav>

  <main class="main-content">
    <!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-content active">
      <div class="challenge-banner" id="challengeBanner">
        <div class="challenge-left">
          <h2 id="challengeTitle">üî• Challenge ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!</h2>
          <p id="challengeDesc">‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô 14:00</p>
        </div>
        <div class="challenge-right">
          <div class="time-display" id="timeDisplay">--:--:--</div>
          <div class="time-label" id="timeLabel">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤</div>
        </div>
      </div>

      <div class="stats-row">
        <div class="stat-card"><div class="value" id="totalProgress">-</div><div class="label">Progress</div></div>
        <div class="stat-card"><div class="value" id="streakCount">0</div><div class="label">üî• Streak</div></div>
        <div class="stat-card"><div class="value" id="totalFast">0</div><div class="label">‚ö° ‡∏°‡∏∑‡∏≠‡πÑ‡∏ß</div></div>
        <div class="stat-card"><div class="value" id="totalCarry">0</div><div class="label">üèãÔ∏è ‡πÄ‡∏î‡∏≠‡∏∞‡πÅ‡∏ö‡∏Å</div></div>
      </div>

      <div class="dashboard-grid">
        <!-- MK Card -->
        <div class="card">
          <div class="card-header">üìä Media Tracking (MK)</div>
          <div class="card-body">
            <div class="progress-section">
              <div class="progress-header"><span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span><span class="progress-count" id="mtkProgress">0/0</span></div>
              <div class="progress-bar"><div class="progress-fill mtk" id="mtkProgressBar" style="width:0%"></div></div>
            </div>
            <div class="campaign-list" id="mtkCampaigns"></div>
            
            <div class="friends-section">
              <div class="friends-title">üíñ UQ Friends <span class="friends-note">(‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö progress)</span></div>
              <div id="mtkFriends"></div>
            </div>
          </div>
        </div>

        <!-- AW Card -->
        <div class="card">
          <div class="card-header">üìä Asean Weekly (AW)</div>
          <div class="card-body">
            <div class="progress-section">
              <div class="progress-header"><span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span><span class="progress-count" id="arpProgress">0/0</span></div>
              <div class="progress-bar"><div class="progress-fill arp" id="arpProgressBar" style="width:0%"></div></div>
            </div>
            <div class="campaign-list" id="arpCampaigns"></div>
            
            <div class="friends-section">
              <div class="friends-title">üíñ UQ Friends <span class="friends-note">(‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö progress)</span></div>
              <div id="arpFriends"></div>
            </div>
          </div>
        </div>

        <!-- Leaderboard -->
        <div class="card">
          <div class="card-header">üèÜ Leaderboard ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
          <div class="card-body">
            <div id="leaderboard"></div>
          </div>
        </div>

        <!-- Badges -->
        <div class="card">
          <div class="card-header">üéñÔ∏è Badge Hall of Fame</div>
          <div class="card-body">
            <div class="badges-grid">
              <div class="badge-item"><div class="icon">‚ö°</div><div class="label">‡∏°‡∏∑‡∏≠‡πÑ‡∏ß</div><div class="count" id="badgeFast">0</div></div>
              <div class="badge-item"><div class="icon">üî•</div><div class="label">‡πÑ‡∏ü‡πÅ‡∏£‡∏á</div><div class="count" id="badgeEarly">0</div></div>
              <div class="badge-item"><div class="icon">üéØ</div><div class="label">‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div><div class="count" id="badgeComplete">0</div></div>
              <div class="badge-item"><div class="icon">üèãÔ∏è</div><div class="label">‡πÄ‡∏î‡∏≠‡∏∞‡πÅ‡∏ö‡∏Å</div><div class="count" id="badgeCarry">0</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ranking Tab -->
    <div id="ranking-tab" class="tab-content">
      <div class="card">
        <div class="card-header">üìà Campaign Summary (Top 3 Best / Worst)</div>
        <div class="card-body">
          <div class="summary-tabs">
            <div class="summary-tab active" onclick="switchSummaryTab('traffic')">üöó Traffic</div>
            <div class="summary-tab" onclick="switchSummaryTab('vdo')">üé¨ VDO</div>
            <div class="summary-tab" onclick="switchSummaryTab('awareness')">üëÅÔ∏è Awareness</div>
          </div>
          
          <div class="summary-content active" id="sum-traffic">
            <div class="below-note" id="below-traffic">‚ö†Ô∏è Below Average: 0 campaigns</div>
            <div class="summary-grid">
              <div class="summary-section"><h4 class="best">üèÜ Top 3 Best (CTR%)</h4><div id="traffic-best"></div></div>
              <div class="summary-section"><h4 class="worst">‚ö†Ô∏è Top 3 Worst (CTR%)</h4><div id="traffic-worst"></div></div>
            </div>
          </div>
          
          <div class="summary-content" id="sum-vdo">
            <div class="below-note" id="below-vdo">‚ö†Ô∏è Below Average: 0 campaigns</div>
            <div class="summary-grid">
              <div class="summary-section"><h4 class="best">üèÜ Top 3 Best (CV%)</h4><div id="vdo-best"></div></div>
              <div class="summary-section"><h4 class="worst">‚ö†Ô∏è Top 3 Worst (CV%)</h4><div id="vdo-worst"></div></div>
            </div>
          </div>
          
          <div class="summary-content" id="sum-awareness">
            <div class="below-note" id="below-awareness">‚ö†Ô∏è Below Average: 0 campaigns</div>
            <div class="summary-grid">
              <div class="summary-section"><h4 class="best">üèÜ Top 3 Best (CPM)</h4><div id="awareness-best"></div></div>
              <div class="summary-section"><h4 class="worst">‚ö†Ô∏è Top 3 Worst (CPM)</h4><div id="awareness-worst"></div></div>
            </div>
          </div>
          
          <!-- Star Request Section -->
          <div class="star-request-section">
            <h3>‚≠ê ‡∏Ç‡∏≠‡∏î‡∏≤‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß / ‡∏î‡∏≤‡∏ß‡πÅ‡∏î‡∏á</h3>
            <p class="star-desc">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Campaign ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏î‡∏≤‡∏ß ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Submit</p>
            <div class="selected-summary">
              <div class="selected-box best">
                <h4>‚≠êüü¢ ‡∏î‡∏≤‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (Best)</h4>
                <div id="selectedBest">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
              </div>
              <div class="selected-box worst">
                <h4>‚≠êüî¥ ‡∏î‡∏≤‡∏ß‡πÅ‡∏î‡∏á (Worst)</h4>
                <div id="selectedWorst">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
              </div>
            </div>
            <button class="submit-star-btn" onclick="submitStarRequest()" id="submitStarBtn" disabled>
              üì® ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏î‡∏≤‡∏ß‡πÑ‡∏õ LINE
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Simulator Tab -->
    <div id="simulator-tab" class="tab-content">
      <div class="simulator-container">
        <div class="phone">
          <div class="phone-screen">
            <div class="phone-header">
              <div class="avatar">ü§ñ</div>
              <div><div class="group-name">‡∏¢‡∏π‡∏ô‡∏¥‡πÇ‡∏Ñ‡∏Å‡∏±‡∏ô‡πÇ‡∏õ‡πä‡∏∞</div><div class="group-members">UQ Buddy + 5 members</div></div>
            </div>
            <div class="chat-area" id="chatArea"></div>
            <div class="chat-input">
              <input type="text" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." onkeypress="if(event.key==='Enter')sendMessage()">
              <button onclick="sendMessage()">‚û§</button>
            </div>
          </div>
        </div>
        
        <div class="sim-controls">
          <div class="control-card">
            <h3>üé¨ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <button class="scenario-btn" onclick="runScenario('morning')"><div class="title">‚òÄÔ∏è ‡πÄ‡∏ä‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</div><div class="desc">Bot ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</div></button>
            <button class="scenario-btn" onclick="runScenario('update')"><div class="title">‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à</div><div class="desc">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à</div></button>
            <button class="scenario-btn" onclick="runScenario('alldone')"><div class="title">üéâ ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏°‡∏î</div><div class="desc">report = all done</div></button>
            <button class="scenario-btn" onclick="runScenario('friends')"><div class="title">üíñ UQ Friends</div><div class="desc">aw neon = done</div></button>
          </div>
          
          <div class="control-card">
            <h3>‚å®Ô∏è ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</h3>
            <div class="quick-commands">
              <button class="quick-cmd" onclick="sendQuickCmd('report = status')">üìä ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
              <button class="quick-cmd update" onclick="sendQuickCmd('report = all done')">‚úÖ All Done</button>
              <button class="quick-cmd" onclick="sendQuickCmd('aw neon = done')">üíñ Friends</button>
              <button class="quick-cmd danger" onclick="sendQuickCmd('report = reset')">üîÑ Reset</button>
            </div>
            
            <div class="sim-status">
              <div class="sim-status-title">üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ MK</div>
              <div class="sim-status-grid">
                <div class="sim-status-item"><span>Linen</span><span class="value pending" id="sim-mtk-linen">Pending</span></div>
                <div class="sim-status-item"><span>Holiday</span><span class="value pending" id="sim-mtk-holiday">Pending</span></div>
                <div class="sim-status-item"><span>Denim</span><span class="value pending" id="sim-mtk-denim">Pending</span></div>
                <div class="sim-status-item"><span>Masterpiece</span><span class="value pending" id="sim-mtk-masterpiece">Pending</span></div>
              </div>
            </div>
            
            <div class="sim-status">
              <div class="sim-status-title">üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AW</div>
              <div class="sim-status-grid">
                <div class="sim-status-item"><span>Linen</span><span class="value pending" id="sim-arp-linen">Pending</span></div>
                <div class="sim-status-item"><span>Holiday</span><span class="value pending" id="sim-arp-holiday">Pending</span></div>
                <div class="sim-status-item"><span>Denim</span><span class="value pending" id="sim-arp-denim">Pending</span></div>
                <div class="sim-status-item"><span>Masterpiece</span><span class="value pending" id="sim-arp-masterpiece">Pending</span></div>
              </div>
            </div>
            
            <div class="sim-status">
              <div class="sim-status-title">üíñ UQ Friends (‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö progress)</div>
              <div class="sim-status-grid">
                <div class="sim-status-item"><span>Neon</span><span class="value pending" id="sim-friends-neon">Pending</span></div>
                <div class="sim-status-item"><span>ModernDuck</span><span class="value pending" id="sim-friends-mdg">Pending</span></div>
              </div>
            </div>
            
            <button class="clear-btn" onclick="clearChat()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó & ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">ü§ñ UQ Buddy Dashboard v5.0 | Last updated: <span id="lastUpdate">-</span></footer>

  <div class="toast" id="toast">‚úÖ Copied!</div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h2>
      <div class="status-indicator"><div class="status-dot" id="statusDot"></div><span id="statusText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span></div>
      <div class="form-group">
        <label>Google Apps Script Web App URL</label>
        <div class="input-wrapper">
          <input type="password" id="apiUrlInput" placeholder="‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." autocomplete="off">
          <button class="toggle-btn" onclick="toggleApi()" id="toggleBtn">üëÅÔ∏è</button>
        </div>
      </div>
      <button class="save-btn" onclick="saveSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
      <div class="help-box">üîí URL ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
      <button class="close-btn" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <script>
// === STATE ===
let API_URL = localStorage.getItem('uq_api_url') || '';
let isConnected = false;
let isUsingDemo = true;

// UQ Friends state (manual toggle)
let friendsStatus = {
  mtk: { neon: false, mdg: false },
  arp: { neon: false, mdg: false }
};

// === HELPERS ===
function getUserTitle(f) {
  if (f >= 10) return 'üëë‡∏£‡∏≤‡∏ä‡∏≤‡∏£‡∏µ‡∏û‡∏≠‡∏£‡πå‡∏ó';
  if (f >= 5) return 'üíé‡πÄ‡∏û‡∏ä‡∏£‡∏£‡∏µ‡∏û‡∏≠‡∏£‡πå‡∏ó';
  if (f >= 3) return 'üåü‡∏î‡∏≤‡∏ß‡∏£‡∏∏‡πà‡∏á‡∏£‡∏µ‡∏û‡∏≠‡∏£‡πå‡∏ó';
  return '';
}

function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2000);
}

function copyCampaign(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    btn.classList.add('copied');
    btn.textContent = '‚úÖ';
    showToast('‚úÖ Copy ‡πÅ‡∏•‡πâ‡∏ß!');
    setTimeout(() => { btn.classList.remove('copied'); btn.textContent = 'üìã'; }, 2000);
  });
}

// === TABS ===
function switchTab(name) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
  document.getElementById(name + '-tab').classList.add('active');
  event.target.classList.add('active');
}

function switchSummaryTab(name) {
  document.querySelectorAll('.summary-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.summary-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('sum-' + name).classList.add('active');
  event.target.classList.add('active');
}

// === CHALLENGE BANNER ===
function updateChallenge() {
  const now = new Date();
  const day = now.getDay();
  const banner = document.getElementById('challengeBanner');
  const title = document.getElementById('challengeTitle');
  const desc = document.getElementById('challengeDesc');
  const display = document.getElementById('timeDisplay');
  const label = document.getElementById('timeLabel');

  if (day === 5 || day === 1) {
    const dayName = day === 5 ? '‡∏®‡∏∏‡∏Å‡∏£‡πå' : '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå';
    const deadline = new Date(); deadline.setHours(14, 0, 0, 0);
    
    if (now >= deadline) {
      banner.classList.add('next');
      title.textContent = 'üéâ ‡∏à‡∏ö Challenge!';
      desc.textContent = '‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô Challenge ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ!';
      display.textContent = '‚ú®';
      label.textContent = '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!';
    } else {
      banner.classList.remove('next');
      title.textContent = 'üî• Challenge ‡∏ß‡∏±‡∏ô' + dayName + '!';
      desc.textContent = '‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô 14:00';
      const diff = deadline - now;
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      display.textContent = [h,m,s].map(n => String(n).padStart(2,'0')).join(':');
      label.textContent = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤';
    }
  } else {
    banner.classList.add('next');
    title.textContent = 'üéÆ Next Challenge';
    const daysToFri = (5 - day + 7) % 7 || 7;
    const daysToMon = (1 - day + 7) % 7 || 7;
    const nextDays = Math.min(daysToFri, daysToMon);
    const nextDayName = nextDays === daysToFri ? '‡∏®‡∏∏‡∏Å‡∏£‡πå' : '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå';
    desc.textContent = '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°!';
    display.textContent = nextDays + ' ‡∏ß‡∏±‡∏ô';
    label.textContent = '‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô' + nextDayName;
  }
}
setInterval(updateChallenge, 1000);
updateChallenge();

// === SETTINGS ===
function openSettings() { document.getElementById('settingsModal').classList.add('show'); document.getElementById('apiUrlInput').value = API_URL; updateStatus(); }
function closeSettings() { document.getElementById('settingsModal').classList.remove('show'); }
function toggleApi() {
  const i = document.getElementById('apiUrlInput');
  const b = document.getElementById('toggleBtn');
  if (i.type === 'password') { i.type = 'text'; b.textContent = 'üîí'; }
  else { i.type = 'password'; b.textContent = 'üëÅÔ∏è'; }
}
function saveSettings() {
  const url = document.getElementById('apiUrlInput').value.trim();
  if (!url) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL'); return; }
  API_URL = url;
  localStorage.setItem('uq_api_url', url);
  closeSettings();
  loadData();
}
function updateStatus() {
  const dot = document.getElementById('statusDot');
  const text = document.getElementById('statusText');
  if (isConnected) { dot.classList.add('connected'); text.textContent = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'; }
  else if (API_URL) { dot.classList.remove('connected'); text.textContent = '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...'; }
  else { dot.classList.remove('connected'); text.textContent = '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL'; }
}
function updateDataSourceBadge() {
  const badge = document.getElementById('dataSource');
  if (isUsingDemo) { badge.className = 'data-source demo'; badge.textContent = 'Demo'; }
  else { badge.className = 'data-source live'; badge.textContent = 'Live'; }
}

// === TOGGLE FRIENDS (sync with Sheet) ===
async function toggleFriend(sys, name) {
  const newStatus = !friendsStatus[sys][name];
  friendsStatus[sys][name] = newStatus;
  renderFriends();
  
  // Sync with Google Sheet via API (‡πÉ‡∏ä‡πâ GET ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å CORS)
  if (API_URL) {
    try {
      const params = new URLSearchParams({
        action: 'updateFriend',
        system: sys,
        friend: name,
        status: newStatus ? 'Done' : 'Pending'
      });
      
      const response = await fetch(API_URL + '?' + params.toString());
      const result = await response.json();
      
      if (result.success) {
        showToast(newStatus ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ' + (name === 'mdg' ? 'ModernDuck' : 'Neon') + ' ‡πÅ‡∏•‡πâ‡∏ß!' : 'üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Pending ‡πÅ‡∏•‡πâ‡∏ß!');
      } else {
        showToast('‚ö†Ô∏è ' + (result.error || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'));
      }
    } catch (e) {
      console.error('Failed to sync friend status:', e);
      showToast('‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }
  }
}

function renderFriends() {
  ['mtk', 'arp'].forEach(sys => {
    const container = document.getElementById(sys + 'Friends');
    container.innerHTML = Object.entries(friendsStatus[sys]).map(([name, done]) => {
      const displayName = name === 'mdg' ? 'ModernDuck' : 'Neon';
      return `<div class="friend-item ${done ? 'done' : ''}">
        <span>${done ? 'üü¢' : 'üü†'} ${displayName}</span>
        <input type="checkbox" class="friend-checkbox" ${done ? 'checked' : ''} onchange="toggleFriend('${sys}', '${name}')">
      </div>`;
    }).join('');
  });
}

// === LOAD DATA ===
async function loadData() {
  if (!API_URL) { isUsingDemo = true; isConnected = false; updateDataSourceBadge(); updateStatus(); loadDemo(); return; }
  try {
    const res = await fetch(`${API_URL}?action=dashboard`);
    if (!res.ok) throw new Error('API Error');
    const data = await res.json();
    isConnected = true; isUsingDemo = false; updateDataSourceBadge(); updateStatus();
    render(data);
  } catch (e) {
    console.error(e);
    isConnected = false; isUsingDemo = true; updateDataSourceBadge(); updateStatus();
    loadDemo();
  }
}

function loadDemo() {
  render({
    reportWeek: 'Demo Mode',
    mtk: { progress: { done: 3, total: 4 }, campaigns: [{ name: 'Linen', status: 'Done' }, { name: 'Holiday', status: 'Done' }, { name: 'Denim', status: 'Done' }, { name: 'Masterpiece', status: 'Pending' }] },
    arp: { progress: { done: 2, total: 4 }, campaigns: [{ name: 'Linen', status: 'Done' }, { name: 'Holiday', status: 'Done' }, { name: 'Denim', status: 'Pending' }, { name: 'Masterpiece', status: 'Pending' }] },
    leaderboard: [{ name: '‡∏´‡∏≠‡∏Å‡∏≠', time: '11:23', count: 5, badges: { fast: 3, early: 2, complete: 1, carry: 2 } }, { name: '‡∏û‡∏µ‡πà‡πÄ‡∏ö‡∏ô‡∏ã‡πå', time: '11:45', count: 2, badges: { fast: 1, early: 1, complete: 0, carry: 0 } }],
    badges: { totalFast: 4, totalEarly: 3, totalComplete: 1, totalCarry: 2 },
    streak: 3,
    belowStats: { traffic: 2, vdo: 3, awareness: 1 },
    summary: {
      traffic: {
        best: [{ rank: 1, campaign: 'Uniqlo_LO_Meta_[POST 3]_SNS_Traffic_191225-221225_CPC_1-4_129000_2025122892', result: 'CTR 2.35%' }, { rank: 2, campaign: 'Uniqlo_Holiday_Meta_[SNS #6]_SNS_Traffic_221225-311225', result: 'CTR 1.59%' }, { rank: 3, campaign: 'Uniqlo_Holiday_Meta_[SNS #7]_SNS_Traffic_231225-311225', result: 'CTR 1.39%' }],
        worst: [{ rank: 1, campaign: 'Uniqlo_UT_IG_[Post 6]_SNS_Traffic_221225-281225', result: 'CTR 0.91%' }, { rank: 2, campaign: 'Uniqlo_Holiday_Meta_[SNS #5]_SNS_Traffic_221225-311225', result: 'CTR 1.34%' }, { rank: 3, campaign: 'Uniqlo_UT_FB_[Post 6]_SNS_Traffic_221225-281225', result: 'CTR 1.37%' }]
      },
      vdo: {
        best: [{ rank: 1, campaign: 'Uniqlo_Special Collection_IG_[26SS JWA]_Reel_VDO Views', result: 'CV 20.74%' }, { rank: 2, campaign: 'Uniqlo_Special Collection_IG_[26SS CPJ]_SNS_VDO Views', result: 'CV 17.09%' }, { rank: 3, campaign: 'Uniqlo_Masterpiece_IG_[25SS Fleece]_Post_VDO Views', result: 'CV 10.86%' }],
        worst: [{ rank: 1, campaign: 'Uniqlo_Sweat 26SS_TT_[KOL Icepariss]_VDO Views', result: 'CV 0.52%' }, { rank: 2, campaign: 'Uniqlo_Sweat 26SS_TT_[KOL gybdd]_VDO Views', result: 'CV 0.72%' }, { rank: 3, campaign: 'Uniqlo_Holiday_TT_[bowlingfreckled]_VDO Views', result: 'CV 1.16%' }]
      },
      awareness: {
        best: [{ rank: 1, campaign: 'Uniqlo_Special Collection_FB_[26SS JWA]_Awareness', result: 'CPM 8.54' }, { rank: 2, campaign: 'Uniqlo_New items_Meta_[Dec Post 4]_Awareness', result: 'CPM 8.82' }, { rank: 3, campaign: 'Uniqlo_Special Collection_IG_[26SS JWA]_Awareness', result: 'CPM 8.83' }],
        worst: [{ rank: 1, campaign: 'Uniqlo_Sustainability_Meta_[Post 2 HT]_Awareness', result: 'CPM 11.51' }, { rank: 2, campaign: 'Uniqlo_LO_Meta_[POST 3]_Awareness', result: 'CPM 10.82' }, { rank: 3, campaign: 'Uniqlo_Special Collection_IG_[JWA IG]_Awareness', result: 'CPM 8.83' }]
      }
    }
  });
}

function render(data) {
  document.getElementById('weekBadge').textContent = 'üìÖ ' + (data.reportWeek || '-');
  
  // Progress
  ['mtk', 'arp'].forEach(sys => {
    const { progress, campaigns } = data[sys];
    const pct = progress.total > 0 ? (progress.done / progress.total * 100) : 0;
    document.getElementById(sys + 'Progress').textContent = progress.done + '/' + progress.total;
    document.getElementById(sys + 'ProgressBar').style.width = pct + '%';
    document.getElementById(sys + 'Campaigns').innerHTML = campaigns.map(c => 
      `<div class="campaign-item ${c.status.toLowerCase()}"><span>${c.name}</span><span class="campaign-status ${c.status.toLowerCase()}">${c.status === 'Done' ? 'üü¢ Done' : 'üü† Pending'}</span></div>`
    ).join('');
  });
  
  // ‚úÖ Load Friends status from API
  if (data.friends) {
    friendsStatus = {
      mtk: { 
        neon: data.friends.mtk?.neon === 'Done', 
        mdg: data.friends.mtk?.mdg === 'Done' 
      },
      arp: { 
        neon: data.friends.arp?.neon === 'Done', 
        mdg: data.friends.arp?.mdg === 'Done' 
      }
    };
  }
  renderFriends();
  
  // Stats
  const totalDone = data.mtk.progress.done + data.arp.progress.done;
  const totalAll = data.mtk.progress.total + data.arp.progress.total;
  document.getElementById('totalProgress').textContent = Math.round(totalDone/totalAll*100) + '%';
  document.getElementById('streakCount').textContent = data.streak || 0;
  document.getElementById('totalFast').textContent = data.badges?.totalFast || 0;
  document.getElementById('totalCarry').textContent = data.badges?.totalCarry || 0;
  
  // Leaderboard
  const medals = ['ü•á', 'ü•à', 'ü•â'];
  document.getElementById('leaderboard').innerHTML = data.leaderboard?.length ? data.leaderboard.slice(0, 5).map((u, i) => {
    const title = getUserTitle(u.badges?.fast || 0);
    const badges = [];
    if (u.badges?.fast) badges.push('‚ö°' + u.badges.fast);
    if (u.badges?.early) badges.push('üî•' + u.badges.early);
    if (u.badges?.carry) badges.push('üèãÔ∏è' + u.badges.carry);
    return `<div class="leaderboard-item ${i === 0 ? 'gold' : ''}"><div class="rank-badge r${Math.min(i+1,3)}">${medals[i] || (i+1)}</div><div class="user-info"><div class="user-name">${u.name}${title ? '<span class="user-title">' + title + '</span>' : ''}</div><div class="user-time">‚è∞ ${u.time} ‡∏ô. ‚Ä¢ ${u.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div><div>${badges.map(b => '<span class="badge-count">' + b + '</span>').join('')}</div></div>`;
  }).join('') : '<div style="color:var(--text-secondary);text-align:center;padding:1rem;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
  
  // Badges
  document.getElementById('badgeFast').textContent = data.badges?.totalFast || 0;
  document.getElementById('badgeEarly').textContent = data.badges?.totalEarly || 0;
  document.getElementById('badgeComplete').textContent = data.badges?.totalComplete || 0;
  document.getElementById('badgeCarry').textContent = data.badges?.totalCarry || 0;
  
  // Below Stats
  if (data.belowStats) {
    document.getElementById('below-traffic').textContent = '‚ö†Ô∏è Below Average: ' + data.belowStats.traffic + ' campaigns' + (data.belowStats.traffic === 0 ? ' (‡∏ô‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)' : '');
    document.getElementById('below-vdo').textContent = '‚ö†Ô∏è Below Average: ' + data.belowStats.vdo + ' campaigns' + (data.belowStats.vdo === 0 ? ' (‡∏ô‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)' : '');
    document.getElementById('below-awareness').textContent = '‚ö†Ô∏è Below Average: ' + data.belowStats.awareness + ' campaigns' + (data.belowStats.awareness === 0 ? ' (‡∏ô‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)' : '');
  }
  
  // Summary with checkboxes
  if (data.summary) {
    window.summaryData = data.summary; // Store for later use
    ['traffic', 'vdo', 'awareness'].forEach(type => {
      const s = data.summary[type];
      if (s) {
        document.getElementById(type + '-best').innerHTML = (s.best || []).slice(0, 3).map((item, idx) => 
          `<label class="campaign-checkbox" onclick="event.stopPropagation()">
            <input type="checkbox" data-type="${type}" data-category="best" data-campaign="${item.campaign.replace(/"/g, '&quot;')}" data-result="${item.result}" onchange="updateStarSelection()">
            <span class="camp-name">${item.campaign}</span>
            <span class="camp-result">${item.result}</span>
          </label>`
        ).join('') || '<div style="color:var(--text-secondary);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
        
        document.getElementById(type + '-worst').innerHTML = (s.worst || []).slice(0, 3).map((item, idx) => 
          `<label class="campaign-checkbox" onclick="event.stopPropagation()">
            <input type="checkbox" data-type="${type}" data-category="worst" data-campaign="${item.campaign.replace(/"/g, '&quot;')}" data-result="${item.result}" onchange="updateStarSelection()">
            <span class="camp-name">${item.campaign}</span>
            <span class="camp-result">${item.result}</span>
          </label>`
        ).join('') || '<div style="color:var(--text-secondary);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
      }
    });
  }
  
  document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('th-TH');
}

// === STAR REQUEST ===
let selectedBest = [];
let selectedWorst = [];

function updateStarSelection() {
  selectedBest = [];
  selectedWorst = [];
  
  document.querySelectorAll('.campaign-checkbox input:checked').forEach(cb => {
    const campaign = cb.dataset.campaign;
    const result = cb.dataset.result;
    const category = cb.dataset.category;
    const item = { campaign, result };
    
    if (category === 'best') {
      selectedBest.push(item);
    } else {
      selectedWorst.push(item);
    }
    
    cb.closest('.campaign-checkbox').classList.add('checked');
  });
  
  document.querySelectorAll('.campaign-checkbox input:not(:checked)').forEach(cb => {
    cb.closest('.campaign-checkbox').classList.remove('checked');
  });
  
  // Update display
  document.getElementById('selectedBest').innerHTML = selectedBest.length > 0 
    ? selectedBest.map(i => `<div class="selected-item">‚Ä¢ ${i.campaign.substring(0, 50)}...</div>`).join('') 
    : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
    
  document.getElementById('selectedWorst').innerHTML = selectedWorst.length > 0 
    ? selectedWorst.map(i => `<div class="selected-item">‚Ä¢ ${i.campaign.substring(0, 50)}...</div>`).join('') 
    : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
  
  // Enable/disable submit button
  const hasSelection = selectedBest.length > 0 || selectedWorst.length > 0;
  document.getElementById('submitStarBtn').disabled = !hasSelection;
}

async function submitStarRequest() {
  if (selectedBest.length === 0 && selectedWorst.length === 0) {
    showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Campaign ‡∏Å‡πà‡∏≠‡∏ô');
    return;
  }
  
  if (!API_URL) {
    showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API URL ‡∏Å‡πà‡∏≠‡∏ô');
    return;
  }
  
  // Build message
  let message = '‚≠ê ‡∏Ç‡∏≠‡∏î‡∏≤‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡πÅ‡∏•‡∏∞ ‡∏î‡∏≤‡∏ß‡πÅ‡∏î‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏ô‡∏µ‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö\n\n';
  
  if (selectedBest.length > 0) {
    message += '‚≠êüü¢ ‡∏î‡∏≤‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (Best)\n';
    selectedBest.forEach(i => {
      message += `‚Ä¢ ${i.campaign}\n  ‚Üí ${i.result}\n`;
    });
    message += '\n';
  }
  
  if (selectedWorst.length > 0) {
    message += '‚≠êüî¥ ‡∏î‡∏≤‡∏ß‡πÅ‡∏î‡∏á (Worst)\n';
    selectedWorst.forEach(i => {
      message += `‚Ä¢ ${i.campaign}\n  ‚Üí ${i.result}\n`;
    });
  }
  
  // Send to LINE via API
  try {
    const params = new URLSearchParams({
      action: 'sendStarRequest',
      message: message
    });
    
    const img = new Image();
    img.onload = img.onerror = () => {
      showToast('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏î‡∏≤‡∏ß‡πÑ‡∏õ LINE ‡πÅ‡∏•‡πâ‡∏ß!');
      // Clear selections
      document.querySelectorAll('.campaign-checkbox input:checked').forEach(cb => cb.checked = false);
      updateStarSelection();
    };
    img.src = API_URL + '?' + params.toString();
    
  } catch (e) {
    console.error('Failed to send star request:', e);
    showToast('‚ö†Ô∏è ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  }
}

// === SIMULATOR ===
let mtkStatus = { linen: 'pending', holiday: 'pending', denim: 'pending', masterpiece: 'pending' };
let arpStatus = { linen: 'pending', holiday: 'pending', denim: 'pending', masterpiece: 'pending' };
let simFriendsStatus = { neon: 'pending', mdg: 'pending' };
let currentUserName = '‡∏Ñ‡∏∏‡∏ì';

function countDone(o) { return Object.values(o).filter(s => s === 'done').length; }
function isAllDone() { return countDone(mtkStatus) === 4 && countDone(arpStatus) === 4; }

function getStatusText(sys) {
  const o = sys === 'mtk' ? mtkStatus : arpStatus;
  return Object.entries(o).map(([n, s]) => (s === 'done' ? 'üü¢' : 'üü†') + ' ' + n.charAt(0).toUpperCase() + n.slice(1) + ' : ' + (s === 'done' ? 'Done' : 'Pending')).join('\n');
}

function getFullStatus() {
  return 'üìä MK (' + countDone(mtkStatus) + '/4)\n' + getStatusText('mtk') + '\n\nüìä AW (' + countDone(arpStatus) + '/4)\n' + getStatusText('arp');
}

function updateSimStatus() {
  Object.entries(mtkStatus).forEach(([n, s]) => { const el = document.getElementById('sim-mtk-' + n); if (el) { el.textContent = s === 'done' ? 'Done' : 'Pending'; el.className = 'value ' + s; } });
  Object.entries(arpStatus).forEach(([n, s]) => { const el = document.getElementById('sim-arp-' + n); if (el) { el.textContent = s === 'done' ? 'Done' : 'Pending'; el.className = 'value ' + s; } });
  Object.entries(simFriendsStatus).forEach(([n, s]) => { const el = document.getElementById('sim-friends-' + n); if (el) { el.textContent = s === 'done' ? 'Done' : 'Pending'; el.className = 'value ' + s; } });
}

function resetSim() {
  mtkStatus = { linen: 'pending', holiday: 'pending', denim: 'pending', masterpiece: 'pending' };
  arpStatus = { linen: 'pending', holiday: 'pending', denim: 'pending', masterpiece: 'pending' };
  simFriendsStatus = { neon: 'pending', mdg: 'pending' };
  updateSimStatus();
}

function addMsg(text, isUser) {
  const area = document.getElementById('chatArea');
  const div = document.createElement('div');
  div.className = 'message ' + (isUser ? 'user' : 'bot');
  div.innerHTML = isUser ? text : '<div class="bot-name">UQ Buddy</div><span class="mention-tag">@' + currentUserName + '</span>\n' + text;
  area.appendChild(div);
  area.scrollTop = area.scrollHeight;
}

function showTyping() {
  const area = document.getElementById('chatArea');
  const div = document.createElement('div');
  div.className = 'typing-indicator';
  div.id = 'typing';
  div.innerHTML = '<span></span><span></span><span></span>';
  area.appendChild(div);
  area.scrollTop = area.scrollHeight;
}

function hideTyping() { const t = document.getElementById('typing'); if (t) t.remove(); }

function processCmd(text) {
  const lower = text.toLowerCase().trim();
  
  // report = status
  if (lower === 'report = status') return '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î üëá\n\n' + getFullStatus();
  
  // report = reset
  if (lower === 'report = reset') { resetSim(); return 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚ú®'; }
  
  // report = all done (‡πÉ‡∏´‡∏°‡πà!)
  if (lower === 'report = all done') {
    mtkStatus = { linen: 'done', holiday: 'done', denim: 'done', masterpiece: 'done' };
    arpStatus = { linen: 'done', holiday: 'done', denim: 'done', masterpiece: 'done' };
    updateSimStatus();
    return '‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô Done ‡πÅ‡∏•‡πâ‡∏ß!\n\nüéâüéâüéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! üëïüôÇ\n\n' + getFullStatus();
  }
  
  // UQ Friends: aw neon = done / aw mdg = done / mk neon = done / mk mdg = done
  const friendsMatch = lower.match(/(mk|aw)\s+(neon|mdg)\s*=\s*done/);
  if (friendsMatch) {
    const friendName = friendsMatch[2];
    simFriendsStatus[friendName] = 'done';
    updateSimStatus();
    const displayName = friendName === 'mdg' ? 'ModernDuck' : 'Neon';
    return 'üíñ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ' + displayName + ' ‡∏Ñ‡∏£‡∏±‡∏ö!\n\n(UQ Friends ‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô progress ‡πÅ‡∏ï‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚ú®)';
  }

  // Regular update: mk/aw campaign = done
  const match = lower.match(/(mk|aw)\s+(.+)\s*=\s*done/);
  if (match) {
    const sys = match[1] === 'mk' ? 'mtk' : 'arp';
    const sysName = sys === 'mtk' ? 'MK' : 'AW';
    const obj = sys === 'mtk' ? mtkStatus : arpStatus;
    const camps = match[2].split(',').map(s => s.trim().toLowerCase()).filter(Boolean);
    const updated = [];
    camps.forEach(c => {
      if (obj[c] !== undefined) { obj[c] = 'done'; updated.push(c); }
      else { const k = Object.keys(obj).find(k => k.includes(c) || c.includes(k)); if (k) { obj[k] = 'done'; updated.push(k); } }
    });
    updateSimStatus();
    if (updated.length > 0) {
      // Check if this person has most campaigns (‡πÄ‡∏î‡∏≠‡∏∞‡πÅ‡∏ö‡∏Å)
      const carryMsg = updated.length >= 3 ? '\n\nüèãÔ∏è ‡πÄ‡∏î‡∏≠‡∏∞‡πÅ‡∏ö‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å!' : '';
      if (isAllDone()) return '‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ' + sysName + ':\n' + updated.map(n => '‚Ä¢ ' + n).join('\n') + '\n\nüéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! üëïüôÇ' + carryMsg;
      return '‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ' + sysName + ':\n' + updated.map(n => '‚Ä¢ ' + n).join('\n') + '\n\n' + getFullStatus() + carryMsg;
    }
  }
  return null;
}

function sendMessage() {
  const input = document.getElementById('messageInput');
  const text = input.value.trim();
  if (!text) return;
  addMsg(text, true);
  input.value = '';
  showTyping();
  setTimeout(() => { hideTyping(); const r = processCmd(text); if (r) addMsg(r, false); }, 800);
}

function sendQuickCmd(cmd) { document.getElementById('messageInput').value = cmd; sendMessage(); }

function clearChat() { document.getElementById('chatArea').innerHTML = ''; resetSim(); }

function runScenario(type) {
  clearChat();
  if (type === 'morning') setTimeout(() => addMsg('‚òÄÔ∏è ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö\n\nüìå ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\nüìä AW ‚Üí shorturl.asia/NQqVt\nüìä MK ‚Üí shorturl.asia/viFxd\n\n‚è∞ Deadline 14:00\n\n' + getFullStatus(), false), 500);
  if (type === 'update') { setTimeout(() => addMsg('aw linen,holiday = done', true), 300); setTimeout(() => showTyping(), 600); setTimeout(() => { hideTyping(); arpStatus.linen = 'done'; arpStatus.holiday = 'done'; updateSimStatus(); addMsg('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï AW:\n‚Ä¢ linen\n‚Ä¢ holiday\n\n' + getFullStatus(), false); }, 1500); }
  if (type === 'alldone') { setTimeout(() => addMsg('report = all done', true), 300); setTimeout(() => showTyping(), 600); setTimeout(() => { hideTyping(); mtkStatus = { linen: 'done', holiday: 'done', denim: 'done', masterpiece: 'done' }; arpStatus = { linen: 'done', holiday: 'done', denim: 'done', masterpiece: 'done' }; updateSimStatus(); addMsg('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô Done ‡πÅ‡∏•‡πâ‡∏ß!\n\nüéâüéâüéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! üëïüôÇ', false); }, 1500); }
  if (type === 'friends') { setTimeout(() => addMsg('aw neon = done', true), 300); setTimeout(() => showTyping(), 600); setTimeout(() => { hideTyping(); simFriendsStatus.neon = 'done'; updateSimStatus(); addMsg('üíñ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Neon ‡∏Ñ‡∏£‡∏±‡∏ö!\n\n(UQ Friends ‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô progress ‡πÅ‡∏ï‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚ú®)', false); }, 1500); }
}

// === INIT ===
document.addEventListener('DOMContentLoaded', () => {
  updateStatus();
  loadData();
  setTimeout(() => addMsg('‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! üëã\n\n‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ UQ Buddy\n\n‡∏•‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå:\n‚Ä¢ "report = status" ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞\n‚Ä¢ "report = all done" ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\n‚Ä¢ "aw neon = done" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UQ Friends', false), 500);
});

setInterval(loadData, 60000);
document.getElementById('settingsModal').addEventListener('click', e => { if (e.target.id === 'settingsModal') closeSettings(); });
  </script>
</body>
</html>
